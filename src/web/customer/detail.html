<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>会社概要</h1>
    <div id="company-name"></div>
    <div id="industry"></div>
    <div id="contact"></div>
    <div id="location"></div>    
    <button id="customer-delete">削除</button>
    <script type="module">
        //転送された会社データ
        function getQueryParameters() {
            const queryString = window.location.search;            
            const urlParams = new URLSearchParams(queryString);            
            return Object.fromEntries(urlParams.entries());
        }
        
        const queryParams = getQueryParameters();                      

        //idに一致する会社を抜き出す
        import config from "../config.js";
        fetch(`${config.apiUrl}/customerById`,{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 'customerId': queryParams.customerId }),
        })                    
        .then((response) => {
            console.log(response); // ここでレスポンスオブジェクトをログに出力
            return response.json();
        })
        .then((data) => {
            console.log(data); // ここで解析されたデータをログに出力
            $('#company-name').text('会社名： '+data[0].company_name);            
            $('#industry').text('業種： '+data[0].industry);
            $('#contact').text('連絡先： '+data[0].contact);
            $('#location').text('所在地： '+data[0].location);
        })
        .catch((error) => console.error(error));

        $('#customer-delete').click(function(){
            var confirmResult = window.confirm('削除してもいいですか');

            if (confirmResult) {
                console.log(queryParams.customerId);
                fetch(`${config.apiUrl}/deleteCustomer`,{
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 'customerId': queryParams.customerId }),
                })                    
                .then((response) => {
                    console.log(response); // ここでレスポンスオブジェクトをログに出力
                    return response.json();
                })
                .then((data) => {
                    console.log(data); // ここで解析されたデータをログに出力
                })
                .catch((error) => console.error(error));                                
            } else {                
                console.log('削除処理をキャンセルしました');
            }                                   
        })
        
    </script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</body>
</html>